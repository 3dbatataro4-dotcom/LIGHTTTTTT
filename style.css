:root {
    --bg-deep: #020609;
    --bg-panel: #061016;
    --border: #1a2f3a;
    --sonar: #00b0ff;
    --sonar-dim: rgba(0, 176, 255, 0.15);
    --alert: #ff1744;
    --gold: #ffca28;
    --text: #e0f7fa;
    --scanline: rgba(0, 0, 0, 0.4);
}

* { box-sizing: border-box; user-select: none; }

body {
    background-color: var(--bg-deep);
    color: var(--text);
    font-family: 'Courier New', Courier, monospace;
    margin: 0; height: 100dvh; display: flex; flex-direction: column; overflow: hidden;
    background-image: linear-gradient(rgba(2, 6, 9, 0.9), rgba(2, 6, 9, 0.9)), url('https://filegarden.com/6967bdf6f87068670dc24a24/background.jpg');
    background-size: cover; background-position: center;
}

body::after {
    content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
    z-index: 999; background-size: 100% 2px, 3px 100%; pointer-events: none;
}

.top-hud {
    background: rgba(0,0,0,0.8); border-bottom: 2px solid var(--sonar);
    padding: 10px 25px; display: flex; justify-content: space-between; align-items: center;
    height: 75px; z-index: 20; box-shadow: 0 0 20px var(--sonar-dim);
}

.status-grid { display: flex; gap: 25px; }
.stat-block { display: flex; flex-direction: column; min-width: 70px; }
.stat-label { font-size: 0.7rem; color: #546e7a; letter-spacing: 1px; margin-bottom: 3px; }
.stat-val { font-size: 1.2rem; font-weight: bold; color: var(--sonar); text-shadow: 0 0 5px var(--sonar); }
.stat-val.alert { color: var(--alert); text-shadow: 0 0 5px var(--alert); animation: blink 1s infinite; }

/* ğŸŒŸ å„ªåŒ–ï¼šä¿®æ­£æœ€å¤§æ•¸å€¼ (å¦‚ /100) çš„æ¨¡ç³Šå•é¡Œ */
.stat-val span {
    color: rgba(255, 255, 255, 0.5) !important; /* å¼·åˆ¶è¦†è“‹ inline style çš„ #555 */
    font-weight: normal;
    text-shadow: none; /* ç§»é™¤ç™¼å…‰ä»¥å¢åŠ æ¸…æ™°åº¦ */
}

.time-panel { text-align: right; border-left: 1px solid #333; padding-left: 20px; }
.day-text { color: var(--alert); font-weight: bold; font-size: 1.3rem; text-shadow: 0 0 8px var(--alert); }
.time-text { color: var(--text); font-size: 1.1rem; }
.weather-text { color: var(--sonar); font-size: 0.9rem; margin-top: 5px; }

.viewport { flex: 1; position: relative; display: flex; overflow: hidden; }
.side-nav {
    width: 250px; background: rgba(2, 6, 9, 0.95); border-right: 1px solid var(--border);
    display: flex; flex-direction: column; padding: 15px 10px;
}

.nav-btn {
    background: transparent; border: 1px solid #1a2f3a; color: #78909c;
    padding: 15px; margin-bottom: 8px; cursor: pointer; text-align: left;
    transition: 0.2s; font-family: inherit; font-size: 1rem; border-radius: 4px;
}
.nav-btn:hover { background: var(--sonar-dim); color: var(--sonar); border-color: var(--sonar); }
.nav-btn.active { background: var(--sonar-dim); color: var(--sonar); border-color: var(--sonar); font-weight: bold; box-shadow: inset 0 0 10px var(--sonar-dim); }

.btn-launch {
    margin-top: auto; background: #000; color: var(--sonar); border: 2px solid var(--sonar);
    padding: 20px; font-size: 1.2rem; text-align: center; cursor: pointer; font-weight: bold;
    text-transform: uppercase; box-shadow: 0 0 15px var(--sonar-dim); transition: 0.3s;
}
.btn-launch:hover { background: var(--sonar); color: #000; box-shadow: 0 0 25px var(--sonar); }

.content-area { flex: 1; padding: 25px; overflow-y: auto; background: rgba(6, 16, 22, 0.85); position: relative; }
.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }

.tech-card {
    background: rgba(0, 10, 15, 0.7); border: 1px solid var(--border); padding: 15px;
    position: relative; display: flex; flex-direction: column; transition: 0.2s;
}
.tech-card:hover { border-color: var(--sonar); background: rgba(0, 230, 118, 0.05); transform: translateY(-2px); }

/* --- ğŸŒŸ è§’è‰²å¡ç‰‡é ­åƒèˆ‡æ’ç‰ˆä¿®å¾© --- */
.card-header { 
    display: flex; justify-content: space-between; margin-bottom: 10px; 
    border-bottom: 1px dashed #333; padding-bottom: 10px; 
    align-items: center; /* ç¢ºä¿é ­åƒå’Œå³é‚Šçš„æ–‡å­—å‚ç›´ç½®ä¸­å°é½Š */
}

/* æ§åˆ¶å¤§é ­è²¼çš„å¤§å°ï¼Œé˜²æ­¢æ’ç ´ç‰ˆé¢ */
.card-avatar, .card-avatar-fallback {
    width: 45px; height: 45px; border-radius: 6px; 
    border: 1px solid var(--sonar); margin-right: 12px; 
    object-fit: cover; flex-shrink: 0; /* é˜²æ­¢è¢«æ“ å£“ */
}

/* ç•¶åœ–ç‰‡å¤±æ•ˆæ™‚çš„æ›¿ä»£æ–‡å­—åœ“æ¡† */
.card-avatar-fallback {
    display: flex; align-items: center; justify-content: center;
    background: #111; color: var(--sonar); font-weight: bold; font-size: 1.5rem;
}

/* å¾®èª¿å€‹äºº SAN å€¼æ¢çš„é–“è· */
.tech-card .card-body > div:nth-child(2) {
    margin-top: 15px !important;
}

.card-info { flex: 1; }
.card-title { color: var(--sonar); font-weight: bold; font-size: 1.1rem; margin-bottom: 3px; }
.card-cost { color: var(--gold); font-size: 0.9rem; }
.card-body { font-size: 0.85rem; color: #b0bec5; line-height: 1.5; margin-bottom: 15px; flex: 1; }

.tech-btn {
    width: 100%; background: transparent; border: 1px solid var(--sonar); color: var(--sonar);
    padding: 10px; cursor: pointer; text-transform: uppercase; font-size: 0.95rem; font-weight: bold; transition: 0.2s;
}
.tech-btn:hover:not(:disabled) { background: var(--sonar); color: #000; }
.tech-btn:disabled { border-color: #444; color: #555; cursor: not-allowed; }

.codex-item {
    border: 1px solid #333; background: #020202; padding: 10px; text-align: center;
    display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 120px;
}
.codex-item.locked { opacity: 0.5; color: #555; }
.codex-icon { font-size: 2rem; margin-bottom: 10px; }

.comm-log {
    border: 1px solid var(--border); background: rgba(0,0,0,0.7); padding: 20px;
    margin-bottom: 25px; display: flex; gap: 20px; align-items: center; border-left: 4px solid var(--gold);
}
.avatar {
    width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--gold);
    object-fit: cover; background: #111; flex-shrink: 0;
}
.avatar-lg { 
    width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--gold); 
    object-fit: cover; background: #111; box-shadow: 0 0 15px rgba(255, 202, 40, 0.2);
    flex-shrink: 0;
}
.dialogue { flex: 1; }
.speaker { color: var(--gold); font-size: 1rem; font-weight: bold; margin-bottom: 5px; }
.msg { color: #fff; font-style: italic; font-size: 1.1rem; line-height: 1.5; }

#sea-layer {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; display: none; flex-direction: column; z-index: 50;
}

.sonar-display {
    flex: 1; position: relative;
    background: radial-gradient(circle, rgba(0,20,30,0.4) 20%, #010305 90%);
    background-size: 100% 100%, 50px 50px, 50px 50px;
    display: flex; align-items: center; justify-content: center; flex-direction: column; overflow: hidden;
}
.sonar-sweep {
    position: absolute; width: 120vh; height: 120vh;
    background: conic-gradient(from 0deg, transparent 270deg, rgba(0, 176, 255, 0.15) 360deg);
    border-radius: 50%; animation: sweep 4s infinite linear; pointer-events: none;
}
.sonar-sweep.fast { animation: sweep 1s infinite linear; }
@keyframes sweep { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

.target-info {
    z-index: 10; text-align: center; border: 2px solid var(--sonar);
    padding: 30px 50px; background: rgba(0,0,0,0.85); box-shadow: 0 0 30px var(--sonar-dim);
    transition: all 0.5s;
}
.dist-big { font-size: 5rem; color: var(--sonar); font-weight: bold; text-shadow: 0 0 15px var(--sonar); font-family: monospace; }

.voyage-progress-container {
    width: 60%; max-width: 600px; height: 10px; border: 1px solid var(--border);
    background: #111; margin-top: 20px; z-index: 10; position: relative;
}
.voyage-progress-bar { height: 100%; background: var(--sonar); width: 0%; transition: width 0.5s linear; box-shadow: 0 0 10px var(--sonar); }

/* --- å„€è¡¨æ¿ä¸»çµæ§‹ (é›»è…¦ç‰ˆ) --- */
.control-panel {
    height: 340px; /* å„ªåŒ–é«˜åº¦ï¼Œé¿å…ä½”ç”¨éå¤šç‰ˆé¢ */
    background: #03080c; border-top: 3px solid var(--border);
    display: flex; flex-direction: column; padding: 15px;
}

.dashboard-main {
    display: grid; 
    grid-template-columns: 260px 1fr 300px; /* å·¦(ç‹€æ…‹) ä¸­(æŒ‡ä»¤) å³(æ—¥èªŒ) */
    gap: 15px; 
    flex: 1; 
    min-height: 0; /* ğŸŒŸè¶…ç´šé—œéµï¼šè®“å…§éƒ¨å®¹å™¨å¯ä»¥æ­£ç¢ºç”Ÿæˆæ»¾å‹•æ¢ */
}

/* ä¸­é–“çš„æŒ‡ä»¤å€å¡Š (ç¯€é» + èˆ¹å“¡) */
.middle-column {
    display: flex; flex-direction: column; gap: 10px;
    overflow-y: auto; /* ğŸŒŸå…è¨±å…§å®¹éå¤šæ™‚ä¸Šä¸‹æ»‘å‹• */
    padding-right: 5px;
}

.bar-container { margin-bottom: 12px; }
.bar-label { display: flex; justify-content: space-between; font-size: 0.8rem; color: #90a4ae; margin-bottom: 4px; }
.bar-track { width: 100%; height: 10px; background: #111; border: 1px solid #333; }
.bar-val { height: 100%; transition: width 0.3s; }

.action-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); /* è‡ªå‹•é©æ‡‰å¯¬åº¦ */
    gap: 10px; 
}

.cmd-btn {
    background: rgba(0, 20, 30, 0.5); border: 1px solid var(--border); color: #fff; padding: 10px;
    text-align: left; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s;
}
.cmd-btn:hover:not(:disabled) { border-color: var(--sonar); background: rgba(0, 230, 118, 0.1); transform: translateY(-2px); }
.cmd-btn:disabled { opacity: 0.3; cursor: not-allowed; filter: grayscale(1); }
.cmd-img { width: 40px; height: 40px; border-radius: 4px; border: 1px solid var(--sonar); object-fit: cover; flex-shrink: 0; }
.cmd-role { font-size: 0.7rem; color: var(--sonar); text-transform: uppercase; margin-bottom: 2px; }
.cmd-name { font-weight: bold; font-size: 1rem; }

/* å·¦å³å…©å´çš„å€å¡Š */
.sys-log {
    border: 1px solid var(--border);
    padding: 15px;
    height: 150px; /* å›ºå®šé«˜åº¦ */
    max-height: 150px;
    overflow-y: auto;
    font-size: 0.85rem;
    color: #cfd8dc;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 6px;
    scroll-behavior: smooth;
}
.log-line { margin-bottom: 6px; border-bottom: 1px dotted #222; padding-bottom: 2px; }

.btn-anchor {
    display: none; margin-top: 20px; background: var(--gold); color: #000;
    border: none; padding: 15px 30px; font-size: 1.5rem; font-weight: bold; cursor: pointer;
    box-shadow: 0 0 20px rgba(255, 202, 40, 0.5); animation: pulse 1.5s infinite;
}

.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.95); z-index: 999; display: none; align-items: center; justify-content: center;
}
.modal-box {
    background: #040a0f; border: 2px solid var(--sonar); padding: 40px;
    max-width: 600px; width: 90%; box-shadow: 0 0 50px var(--sonar-dim);
}

@keyframes blink { 50% { opacity: 0.3; } }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

/* --- ğŸŒŸ å…¨æ¯æŠ•å½±åœ°åœ–æ¨£å¼ --- */
.holo-container {
    position: relative; width: 100%; height: 100%; min-height: 450px;
    background: radial-gradient(circle at center, var(--sonar-dim) 0%, transparent 70%); /* ğŸŒŸ æ”¹ç”¨è®Šæ•¸ */
    border: 1px solid var(--sonar-dim); border-radius: 8px;
    box-shadow: inset 0 0 30px var(--sonar-dim);
    perspective: 1000px; overflow: hidden;
    
    /* ğŸŒŸ ä¿®å¾©åœ°åœ–èˆ‡èƒŒæ™¯ç¶²æ ¼ä¸å±…ä¸­çš„å•é¡Œ */
    background-position: center center !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    flex-direction: column;
}
.scanline {
    position: absolute; top: 0; left: 0; width: 100%; height: 5px;
    background: var(--sonar); opacity: 0.5; box-shadow: 0 0 10px var(--sonar); /* ğŸŒŸ æ”¹ç”¨è®Šæ•¸ */
    animation: scan 8s linear infinite; z-index: 10; pointer-events: none;
}
@keyframes scan { 0% { top: -5%; } 100% { top: 105%; } }

.map-layer {
    position: absolute; width: 100%; height: 100%;
    transform: rotateX(25deg) scale(0.95); transform-style: preserve-3d;
    animation: hover-map 4s ease-in-out infinite alternate;
}
@keyframes hover-map { from { transform: rotateX(25deg) scale(0.95) translateY(0); } to { transform: rotateX(25deg) scale(0.95) translateY(-15px); } }

.map-layer svg { width: 100%; height: 100%; overflow: visible; }
.map-line { fill: none; stroke: var(--sonar); stroke-opacity: 0.3; stroke-width: 2; stroke-dasharray: 5, 5; }
.map-building { fill: var(--sonar-dim); stroke: var(--sonar); stroke-width: 2; transition: 0.3s; cursor: pointer; }
.map-building:hover { fill: var(--sonar); fill-opacity: 0.4; filter: drop-shadow(0 0 10px var(--sonar)); }
.building-label { fill: var(--sonar); font-size: 16px; font-weight: bold; text-shadow: 0 0 8px var(--sonar); pointer-events: none; }

/* --- ğŸŒŸ å…¨æ¯æµ·åœ–ç‰¹æ•ˆ --- */
.sea-map-layer {
    position: absolute; width: 100%; height: 100%;
    transform: rotateX(50deg) scale(1.2); /* å‚¾æ–œåšå‡ºæˆ°è¡“æ¡Œçš„æ„Ÿè¦º */
    transform-style: preserve-3d;
    animation: sea-map-drift 12s infinite linear alternate;
    pointer-events: none;
}
@keyframes sea-map-drift {
    from { transform: rotateX(50deg) scale(1.2) translateY(0px) rotateZ(-2deg); }
    to { transform: rotateX(50deg) scale(1.2) translateY(-30px) rotateZ(2deg); }
}

/* --- ğŸŒŸ UI é ‚éƒ¨å¤§æŒ‰éˆ•è‡ªé©æ‡‰ --- */
.tab-main-btn {
    flex: 1; border: none; margin: 0; border-radius: 0; 
    text-align: center; padding: 15px 5px; font-size: 1rem;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    background: transparent; color: #aaa; transition: 0.3s;
}
#tab-town { border-right: 1px solid #333; }
.tab-main-btn.active { background: rgba(0, 176, 255, 0.1); color: var(--sonar); font-weight: bold; }

/* --- ç§»å‹•ç«¯å„ªåŒ– (Mobile Responsive) --- */
@media (max-width: 768px) {
    body { height: 100vh; overflow: hidden; }
    .top-hud { height: auto; padding: 5px 10px; flex-wrap: wrap; gap: 5px; }
    .status-grid { gap: 10px; flex: 1; justify-content: space-between; width: 100%; }
    .stat-block { min-width: auto; align-items: center; }
    .stat-label { font-size: 0.6rem; }
    .stat-val { font-size: 1rem; }
    
    .time-panel { width: 100%; text-align: center; border-left: none; border-top: 1px solid #333; padding-top: 5px; margin-top: 5px; display: flex; justify-content: space-around; align-items: center; padding-left: 0; }
    .day-text { font-size: 1rem; }
    
    .viewport { flex-direction: column; }
    .side-nav { 
        width: 100%; height: auto; flex-direction: row; overflow-x: auto; 
        padding: 10px; border-right: none; border-bottom: 1px solid var(--border);
        background: #020609; flex-shrink: 0;
    }
    .nav-btn { margin-bottom: 0; margin-right: 10px; white-space: nowrap; padding: 8px 15px; font-size: 0.9rem; }
    .btn-launch { padding: 8px 15px; font-size: 0.9rem; margin-top: 0; margin-left: auto; white-space: nowrap; }
    
    .content-area { padding: 15px; }
    .grid { grid-template-columns: 1fr; }
    
    .control-panel { grid-template-columns: 1fr; height: auto; overflow-y: auto; max-height: 45vh; padding-bottom: 30px; }
    .action-grid { grid-template-columns: repeat(2, 1fr); max-height: none; overflow-y: visible; }
    .sonar-display { min-height: 250px; }
}

/* ç¯€é»èˆ‡é­é‡æˆ°æŒ‰éˆ•æ¨£å¼ */
.enc-choice-btn {
    background: #111; border: 1px solid #333; color: #fff; padding: 15px; 
    text-align: left; cursor: pointer; font-family: inherit; font-size: 1rem; 
    transition: 0.2s; display: flex; justify-content: space-between;
}
.enc-choice-btn:hover:not(:disabled) { border-color: var(--gold); background: rgba(255, 202, 40, 0.1); }
.enc-choice-btn:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); }
.req-tag { color: var(--gold); font-size: 0.8rem; background: #333; padding: 2px 6px; border-radius: 4px; }

.node-btn { border-color: var(--sonar); }
.node-btn:hover:not(:disabled) { background: var(--sonar-dim); transform: translateY(-2px); }

/* =========================================
   æ‰‹æ©Ÿç‰ˆå°ˆç”¨æ’ç‰ˆ (è¢å¹•å¯¬åº¦ 768px ä»¥ä¸‹)
   ========================================= */
@media (max-width: 768px) {
    /* ğŸŒŸ ä¿®å¾©å§”è¨—ç‰ˆå­—é«”æ“ å£“ */
    .tech-card .card-header { align-items: flex-start; }
    .card-title { font-size: 1rem; white-space: normal; line-height: 1.4; }
    .tech-card .card-body { font-size: 0.8rem; }

    /* ğŸŒŸ 1. ä¿®å¾©é ‚éƒ¨æŒ‰éˆ•è¢«è£åˆ‡ */
    .tab-main-btn { padding: 12px 2px; font-size: 0.85rem; }

    /* ğŸŒŸ 2. ä¿®å¾©äººç‰©è©³ç´°ä»‹ç´¹è·‘æ‰ (å¼·åˆ¶å–®æ’ä¸¦ç¸®å°é–“è·) */
    .grid { grid-template-columns: 1fr !important; gap: 10px; }
    .card-header { align-items: center; }
    .card-avatar, .card-avatar-fallback { width: 40px; height: 40px; }
    
    .viewport { flex-direction: column; overflow: hidden; }
    #port-body { flex-direction: column; }
    
    .side-nav { 
        width: 100%; flex-direction: row; overflow-x: auto; padding: 10px; 
        border-right: none; border-bottom: 1px solid var(--border); flex-shrink: 0;
        scrollbar-width: none; 
        -ms-overflow-style: none; 
    }
    .side-nav::-webkit-scrollbar { display: none; }

    /* ğŸŒŸ 3. ä¿®å¾©å‡ºèˆªçœ‹ä¸åˆ°èˆ¹ã€è¢«é»‘å¡Šé®æ“‹çš„å•é¡Œ */
    #sea-layer { flex: 1; flex-direction: column; overflow: hidden; }
    
    .sonar-display { 
        flex: 1 !important; /* è®“æµ·é¢å¼·åˆ¶ä½”æ“šæ‰€æœ‰å‰©é¤˜çš„ä¸ŠåŠéƒ¨ç©ºé–“ */
        min-height: 40vh; /* ä¿éšœæµ·é¢é«˜åº¦ï¼Œèˆ¹æ‰å‡ºå¾—ä¾† */
        position: relative;
    }
    
    .ship-avatar {
        font-size: 3rem; /* æ‰‹æ©Ÿç‰ˆç¨å¾®ç¸®å°èˆ¹é«” */
        bottom: 18%; /* æŠŠèˆ¹å¾€ä¸Šæä¸€é»ï¼Œé¿å…æ²‰åœ¨æœ€åº•éƒ¨è¢« UI æ“‹ä½ */
    }
    
    .control-panel { 
        flex: none !important; /* å–æ¶ˆå½ˆæ€§å»¶ä¼¸ */
        height: 45vh; /* å›ºå®šå°‡æ“ä½œå€é™åˆ¶åœ¨ç•«é¢åº•éƒ¨çš„ 45% */
        display: flex; flex-direction: column; overflow: hidden;
        padding: 8px;
        background: var(--bg-panel); /* å¡«æ»¿é»‘è‰²èƒŒæ™¯ */
        border-top: 1px solid var(--border);
    }

    .dashboard-main { 
        flex: 1; min-height: 0; /* å…è¨±å…§éƒ¨æŒ‰éˆ•éå¤šæ™‚è‡ªå‹•ç”¢ç”Ÿæ»¾å‹•æ¢ */
        overflow-y: auto; padding-bottom: 5px; 
        display: flex; flex-direction: column; gap: 10px; 
    }
    
    .dashboard-main > div:first-child { border-right: none; border-bottom: 1px solid #333; padding-bottom: 10px; padding-right: 0; flex-shrink: 0; }
    .middle-column { overflow-y: visible; flex: none; gap: 5px; }
    
    .action-grid { grid-template-columns: repeat(2, 1fr); gap: 6px; }
    .cmd-btn { padding: 8px; font-size: 0.85rem; }
    .sys-log { height: auto; min-height: 80px; flex: none; padding: 10px; }
}

/* --- UI ç·Šæ¹ŠåŒ–èª¿æ•´ --- */

/* è®“å„€è¡¨æ¿çš„å‹•ä½œæŒ‰éˆ•è®Šå°ä¸€é» */
.cmd-btn {
    padding: 6px 10px; /* æ¸›å°å…§è· */
    gap: 8px;
    font-size: 0.9rem;
}
/* ç¸®å°æŒ‰éˆ•å…§çš„é ­åƒ */
.cmd-img { 
    width: 35px; 
    height: 35px; 
}
/* æ¸›å°æ¨™é¡Œå­—é«” */
.cmd-name {
    font-size: 0.9rem;
}
/* ä¸­é–“å€å¡Šå…§è·å¾®èª¿ */
.middle-column {
    gap: 8px;
}
/* è®“å½ˆçª—å°è©±æ¡†ä¸è¦å¤ªä½”ç©ºé–“ */
.comm-log {
    padding: 15px;
    margin-bottom: 15px;
}
.avatar-lg {
    width: 70px;
    height: 70px;
}
/* èƒŒåŒ…åˆ—è¡¨çš„æŒ‰éˆ•ä¹Ÿç˜¦èº« */
#backpack-list .tech-card {
    padding: 8px;
}

/* --- ğŸŒŠ èˆªæµ·å‰é€²è¦–è¦ºç‰¹æ•ˆ --- */
.ocean-waves {
    position: absolute;
    top: -100%; left: 0; width: 100%; height: 200%;
    /* æ©«å‘çš„æµ·æµªç·šæ¢ + ç›´å‘çš„é€è¦–ç·šæ¢ */
    background-image: 
        linear-gradient(rgba(0, 176, 255, 0.2) 2px, transparent 2px),
        linear-gradient(90deg, rgba(0, 176, 255, 0.05) 1px, transparent 1px);
    background-size: 100% 40px, 40px 100%;
    /* æ§åˆ¶æ»¾å‹•é€Ÿåº¦ï¼Œè¶Šå°è¶Šå¿« */
    animation: moveForward 1.2s linear infinite; 
    pointer-events: none;
    z-index: 1;
}

/* é€éèƒŒæ™¯ä¸æ–·å¾€ä¸‹ç§»å‹•ï¼Œç”¢ç”Ÿèˆ¹éš»å¾€å‰é–‹çš„è¦–è¦ºéŒ¯è¦º */
@keyframes moveForward {
    0% { transform: translateY(0); }
    100% { transform: translateY(40px); } 
}

/* èˆ¹éš»æœ¬é«”æ¼‚æµ®å‹•ç•« */
.ship-avatar {
    position: absolute;
    bottom: 5%; /* æ”¾åœ¨é›·é”å€åä¸‹æ–¹ */
    font-size: 4rem;
    z-index: 5;
    /* è®“èˆ¹æœ‰ç™¼å…‰çš„ç§‘æŠ€æ„Ÿè¼ªå»“ */
    filter: drop-shadow(0 10px 15px rgba(0, 176, 255, 0.6));
    animation: shipBob 2s ease-in-out infinite alternate;
}

/* æ¨¡æ“¬æµ·æµªçš„é«˜ä½èµ·ä¼èˆ‡å·¦å³æ–æ™ƒ */
@keyframes shipBob {
    0% { transform: translateY(-5px) rotate(-3deg) scale(1); }
    100% { transform: translateY(8px) rotate(3deg) scale(1.05); }
}

/* --- ğŸ¦‘ BOSS æˆ°å°ˆå±¬è¦–è¦ºç‰¹æ•ˆ --- */
.boss-screen {
    animation: red-alert 1.5s infinite alternate !important;
    background-color: #050000 !important; /* è®“èƒŒæ™¯è®Šæš—ç´… */
    box-shadow: inset 0 0 150px rgba(255, 0, 0, 0.8) !important; /* é‚Šç·£è¡€ç´… */
}
.boss-screen .sonar-display {
    background: radial-gradient(circle, rgba(150,0,0,0.6) 10%, #100000 80%) !important;
    border-color: var(--alert) !important;
}
.boss-screen .ocean-waves {
    background-image: 
        linear-gradient(rgba(255, 23, 68, 0.3) 2px, transparent 2px),
        linear-gradient(90deg, rgba(255, 23, 68, 0.1) 1px, transparent 1px) !important;
    animation: moveForward 0.5s linear infinite !important; /* ç‹‚æš´æµ·æµª */
}

@keyframes red-alert {
    0% { box-shadow: inset 0 0 50px rgba(255, 23, 68, 0.2); }
    100% { box-shadow: inset 0 0 150px rgba(255, 23, 68, 0.6); }
}

/* å¾©å¤ CRT è¢å¹•é›œè¨Š */
.crt-noise {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: repeating-radial-gradient(circle, transparent 2px, rgba(0,0,0,0.3) 3px);
    opacity: 0.3; pointer-events: none; z-index: 999;
    animation: staticNoise 0.2s infinite;
    display: none; /* é è¨­éš±è— */
}
@keyframes staticNoise {
    0% { transform: translate(0, 0); }
    50% { transform: translate(2px, -2px); }
    100% { transform: translate(-2px, 2px); }
}

/* --- ğŸŒ¦ï¸ å‹•æ…‹å¤©æ°£ç‰¹æ•ˆ --- */
/* æš´é¢¨é›¨ï¼šèƒŒæ™¯è®Šæš— + é›¨æ»´å‹•ç•« */
.weather-storm .sonar-display {
    filter: brightness(0.6) contrast(1.2);
}
.weather-storm .ocean-waves {
    background-image: 
        linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px), /* é›¨æ»´ */
        linear-gradient(90deg, rgba(0, 176, 255, 0.05) 1px, transparent 1px) !important;
    background-size: 20px 40px, 40px 100% !important;
    animation: storm-rain 0.3s linear infinite !important;
}
@keyframes storm-rain { 0% { background-position: 0 0; } 100% { background-position: -10px 40px; } }

/* æ¿ƒéœ§ï¼šæ¨¡ç³Š + ç°æ¿›æ¿› */
.weather-fog .sonar-display {
    filter: blur(2px) grayscale(0.8) brightness(1.2);
}

/* é †é¢¨ï¼šåŠ é€Ÿæ„Ÿ */
.weather-tailwind .ocean-waves { animation-duration: 0.6s !important; }
/* é€†é¢¨ï¼šæ¸›é€Ÿæ„Ÿ */
.weather-headwind .ocean-waves { animation-duration: 2.5s !important; }

/* --- ğŸŒŸ æŠ€èƒ½ç‰¹æ•ˆ --- */
.vfx { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; animation: vfx-flash 0.5s ease-out; border-radius:8px; z-index:5; }
@keyframes vfx-flash { 0% { opacity:0.8; transform:scale(1); } 100% { opacity:0; transform:scale(1.2); } }
.vfx-fire { background: radial-gradient(circle, #ff5722 0%, transparent 70%); box-shadow: 0 0 20px #ff5722 inset; }
.vfx-crit { background: radial-gradient(circle, #d50000 0%, transparent 70%); box-shadow: 0 0 25px #d50000 inset; }
.vfx-slash { background: linear-gradient(135deg, transparent 40%, #b39ddb 50%, transparent 60%); }
.vfx-tech { background: radial-gradient(circle, #00b0ff 0%, transparent 70%); box-shadow: 0 0 15px #00b0ff inset; }
.vfx-chem { background: radial-gradient(circle, #76ff03 0%, transparent 70%); box-shadow: 0 0 15px #76ff03 inset; }
.vfx-heal { background: radial-gradient(circle, #ffca28 0%, transparent 70%); box-shadow: 0 0 15px #ffca28 inset; }
.vfx-repair { background: radial-gradient(circle, #fff 0%, transparent 70%); box-shadow: 0 0 15px #fff inset; }
.vfx-shot { background: radial-gradient(circle, #555 0%, transparent 70%); }

/* --- ğŸŒŸ ç•«é¢éœ‡å‹• --- */
@keyframes shake-hard {
    0% { transform: translate(0, 0) rotate(0deg); }
    10% { transform: translate(-8px, -8px) rotate(-2deg); }
    30% { transform: translate(8px, 6px) rotate(2deg); }
    50% { transform: translate(-6px, 4px) rotate(-1deg); }
    70% { transform: translate(6px, -6px) rotate(1deg); }
    100% { transform: translate(0, 0) rotate(0deg); }
}
.shake { animation: shake-hard 0.6s ease-in-out; }

/* --- å„ªåŒ–å¾Œçš„é›»å½±ç´šä¸‹é›¨ç‰¹æ•ˆ --- */
#weather-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none; /* çµ•å°ä¸èƒ½é˜»æ“‹ç©å®¶é»æ“ŠæŒ‰éˆ• */
    z-index: 50; /* æ”¾åœ¨èƒŒæ™¯ä¹‹ä¸Šï¼ŒUI é¢æ¿ä¹‹ä¸‹ */
    overflow: hidden;
}

.rain-drop {
    position: absolute;
    /* 1. è®“é›¨æ»´è®Šå¾—æ¥µç´°ï¼Œæ‹‰é•·ä»¥ç‡Ÿé€ é«˜é€Ÿä¸‹å¢œçš„éŒ¯è¦º */
    width: 2px; 
    height: 120px; 
    
    /* 2. æ¼¸å±¤é€æ˜åº¦ï¼šé›¨æ»´é ‚éƒ¨é€æ˜ï¼Œåº•éƒ¨æ˜é¡¯ï¼Œé€™æ¨£çœ‹èµ·ä¾†æ‰è‡ªç„¶ */
    background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.4));
    
    /* 3. ä½¿ç”¨ transform é€²è¡Œ GPU ç¡¬é«”åŠ é€Ÿï¼Œè§£æ±ºå¡é “å•é¡Œ */
    animation: rain-fall linear infinite;
}

/* é‡å°ã€Œæ‰“å®Œ BOSS å¾Œçš„å°é®ã€çš„ä¸»é¡Œå‹•æ…‹èª¿æ•´é›¨æ»´é¡è‰² (å¤ªé™½é›¨) */
body.theme-sunny .rain-drop {
    background: linear-gradient(to bottom, rgba(230, 194, 122, 0), rgba(230, 194, 122, 0.4));
}

/* 4. å„ªåŒ–çš„ä¸‹è½å‹•ç•« (åŠ ä¸Š 15 åº¦çš„å‚¾è§’ï¼Œæ¨¡æ“¬é¢¨å¹) */
@keyframes rain-fall {
    0% { 
        transform: translateY(-120px) translateX(0) rotate(15deg); 
        opacity: 0; 
    }
    10% { opacity: 1; } /* å‰›è½ä¸‹æ™‚é¡¯ç¾ */
    80% { opacity: 1; }
    100% { 
        /* å¾€å·¦ä¸‹è§’æ–œè½ï¼Œè¶…è¶Šè¢å¹•åº•éƒ¨ */
        transform: translateY(110vh) translateX(-20vh) rotate(15deg); 
        opacity: 0; 
    }
}

/* --- ğŸŒ€ ç–²å‹æ¥µé™çš„æšˆçœ©ç‰¹æ•ˆ --- */
.dizzy-effect {
    animation: dizzy-wobble 4s ease-in-out infinite alternate;
    filter: blur(1.5px) sepia(30%) saturate(150%) hue-rotate(-10deg);
}
@keyframes dizzy-wobble {
    0% { transform: scale(1) rotate(0deg); }
    100% { transform: scale(1.03) rotate(1.5deg); }
}

/* ç¢ºä¿å…¨æ¯è—åœ–ç¦ç”¨æ™‚ä¸èƒ½é»æ“Š */
.bp-max { pointer-events: none; }

/* --- ğŸŒŸ é­šé›·å°ˆå±¬æ”»æ“Šç‰¹æ•ˆ --- */
.vfx-torpedo { 
    background: radial-gradient(circle, #ffca28 0%, transparent 80%); 
    box-shadow: 0 0 40px #ffca28 inset; 
    animation: vfx-flash 0.8s ease-out; 
}

/* =========================================
   å‹åˆ©å¾Œçš„å°é®ä¸»é¡Œï¼šæº«æš–æ·±æ£•èˆ‡æ©˜é»ƒ (Warm Dark Brown & Orange)
   ========================================= */
body.theme-sunny {
    --bg-deep: #1b120b;            /* æ·±å’–å•¡è‰²èƒŒæ™¯ */
    --bg-panel: #36312E;           /* é¢æ¿èƒŒæ™¯ï¼šä½¿ç”¨è€…æŒ‡å®šçš„æ·±æ£•è‰² */
    --border: #8d6e63;             /* é‚Šæ¡†ï¼šæŸ”å’Œçš„æ£•è‰² */
    --sonar: #ffb74d;              /* ä¸»é¡Œè‰²ï¼šæº«æš–çš„æ©˜é»ƒ */
    --sonar-dim: rgba(255, 183, 77, 0.15);
    --text: #fff8e1;               /* æ–‡å­—ï¼šç±³ç™½ */
    --gold: #ffca28;               /* é‡‘è‰² */
    --alert: #ef5350;              /* è­¦å‘Šè‰²ç¨å¾®æŸ”å’Œä¸€é» */
    
    background-color: var(--bg-deep) !important;
    color: var(--text) !important;
}

/* è¦†è“‹æ‰€æœ‰é¢æ¿èƒŒæ™¯ç‚ºæ·±æ£•è‰²ï¼Œç¢ºä¿çµ±ä¸€æ€§ */
body.theme-sunny .tech-card,
body.theme-sunny .modal-content,
body.theme-sunny .modal-box,
body.theme-sunny .top-hud,
body.theme-sunny .nav-btn,
body.theme-sunny .sys-log,
body.theme-sunny .control-panel,
body.theme-sunny .viewport,
body.theme-sunny .side-nav {
    background: var(--bg-panel) !important;
    border-color: var(--border) !important;
    color: var(--text) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
}

/* æŒ‰éˆ•æ¨£å¼ï¼šæ©˜é»ƒè‰²ç³» */
body.theme-sunny .tech-btn,
body.theme-sunny .cmd-btn {
    background: rgba(255, 183, 77, 0.1) !important;
    border-color: var(--sonar) !important;
    color: var(--sonar) !important;
}
body.theme-sunny .tech-btn:hover:not(:disabled),
body.theme-sunny .cmd-btn:hover:not(:disabled) {
    background: var(--sonar) !important;
    color: #1b120b !important; /* æ‡¸åœæ™‚æ–‡å­—è®Šæ·±è‰² */
}

/* DAY å­—é«”é¡è‰²å›æ­¸æ­£å¸¸ (ä¸å†æ˜¯ç´…è‰²) */
body.theme-sunny .day-text {
    color: var(--sonar) !important;
    text-shadow: none !important;
}

/* å°é®åœ°åœ–å®¹å™¨èƒŒæ™¯ï¼šæ·±æ£•è‰² */
body.theme-sunny .holo-container {
    background: radial-gradient(circle at center, rgba(255, 183, 77, 0.1) 0%, var(--bg-panel) 80%) !important;
    border-color: var(--border) !important;
    box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.5) !important;
}

/* å•†åº—æ»‘æ¢é¡è‰²ï¼šæ©˜é»ƒè‰² */
body.theme-sunny input[type=range] {
    accent-color: var(--sonar) !important;
}

/* å¼·åˆ¶è¦†è“‹è¡Œå…§é¡è‰² (é‡å° JS å¯«æ­»çš„é¡è‰²ï¼Œç¢ºä¿åœ°åœ–å­—é«”è®Šè‰²) */
body.theme-sunny span[style*="color:var(--sonar)"],
body.theme-sunny div[style*="color:var(--sonar)"],
body.theme-sunny text[fill="var(--sonar)"] {
    color: var(--sonar) !important;
    fill: var(--sonar) !important;
}

/* å‹åˆ©ä¸»é¡Œä¸‹çš„æœ€å¤§æ•¸å€¼é¡è‰²å„ªåŒ– */
body.theme-sunny .stat-val span {
    color: rgba(255, 243, 224, 0.5) !important;
}

/* =========================================
   ğŸ’¬ èŠå¤©å®¤ (Messenger) é¢¨æ ¼æ¨£å¼
   ========================================= */
#vn-chat-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 2000; display: none; 
    align-items: center; justify-content: center;
    backdrop-filter: blur(5px);
}

.chat-backdrop {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.6);
}

/* èŠå¤©è¦–çª—æœ¬é«” */
.chat-window {
    position: relative; width: 90%; max-width: 500px; height: 80vh;
    background: var(--bg-panel); border: 1px solid var(--border);
    border-radius: 12px; display: flex; flex-direction: column;
    box-shadow: 0 10px 40px rgba(0,0,0,0.8);
    overflow: hidden; animation: popIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
}

@keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

/* æ¨™é¡Œåˆ— */
.chat-header {
    padding: 15px; background: rgba(0,0,0,0.3); border-bottom: 1px solid var(--border);
    display: flex; justify-content: space-between; align-items: center;
}
.chat-title { font-weight: bold; color: var(--gold); font-size: 1.1rem; }
.chat-close { background: none; border: none; color: #777; font-size: 1.2rem; cursor: pointer; }
.chat-close:hover { color: var(--alert); }

/* è¨Šæ¯å€åŸŸ */
.chat-body {
    flex: 1; padding: 20px; overflow-y: auto;
    display: flex; flex-direction: column; gap: 20px;
    background: rgba(0, 0, 0, 0.2);
}

/* è¨Šæ¯è¡Œ */
.chat-row { display: flex; gap: 15px; align-items: flex-start; }
.chat-row.player-row { justify-content: flex-end; }

/* é ­åƒ */
.chat-avatar {
    width: 50px; height: 50px; border-radius: 50%; 
    border: 2px solid var(--sonar); object-fit: cover;
    background: #000; flex-shrink: 0;
}

/* åå­—èˆ‡æ°£æ³¡å®¹å™¨ */
.chat-content { display: flex; flex-direction: column; gap: 5px; max-width: 75%; }
.chat-name { font-size: 0.8rem; color: var(--sonar); margin-left: 5px; }

/* å°è©±æ°£æ³¡ */
.chat-bubble {
    padding: 12px 16px; border-radius: 12px; font-size: 0.95rem; line-height: 1.5;
    position: relative; word-wrap: break-word;
}
.npc-bubble {
    background: rgba(255, 255, 255, 0.1); color: #e0f7fa;
    border-top-left-radius: 2px;
}
.player-bubble {
    background: var(--sonar-dim); color: var(--sonar); border: 1px solid var(--sonar);
    border-top-right-radius: 2px; max-width: 80%;
}

/* åº•éƒ¨é¸é …å€ */
.chat-footer {
    padding: 15px; border-top: 1px solid var(--border);
    background: rgba(0,0,0,0.3);
    display: flex; flex-direction: column; gap: 10px;
}

.chat-opt-btn {
    background: transparent; border: 1px solid var(--sonar); color: var(--sonar);
    padding: 12px; border-radius: 8px; cursor: pointer; text-align: left;
    transition: 0.2s; font-size: 0.9rem;
}
.chat-opt-btn:hover { background: var(--sonar); color: #000; }

@media (max-width: 768px) {
    .chat-window { width: 95%; height: 90vh; }
}